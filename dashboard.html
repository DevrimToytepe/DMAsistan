<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex, nofollow" />
  <meta name="description" content="DMAsistan Y√∂netim Paneli" />
  <title>Dashboard ‚Äî DMAsistan</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700;800&family=Inter:wght@300;400;500;600&display=swap"
    rel="stylesheet" />
  <style>
    :root {
      --bg: #0A0E1A;
      --bg-2: #0F1428;
      --bg-3: #131829;
      --purple: #7C3AED;
      --purple-light: #9B5CF6;
      --pink: #F43F75;
      --white: #FFFFFF;
      --gray: #A1A1AA;
      --gray-dark: #3F3F46;
      --glass: rgba(255, 255, 255, 0.04);
      --glass-border: rgba(255, 255, 255, 0.08);
      --gradient: linear-gradient(135deg, #7C3AED, #F43F75);
      --transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      --sidebar-w: 248px;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--white);
      min-height: 100vh;
      display: flex;
      overflow-x: hidden;
    }

    h1,
    h2,
    h3 {
      font-family: 'Sora', sans-serif;
      line-height: 1.2;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    .blob {
      position: fixed;
      border-radius: 50%;
      filter: blur(140px);
      opacity: 0.07;
      pointer-events: none;
      z-index: 0;
    }

    .blob-1 {
      width: 700px;
      height: 700px;
      background: var(--purple);
      top: -300px;
      left: -100px;
    }

    .blob-2 {
      width: 500px;
      height: 500px;
      background: var(--pink);
      bottom: -200px;
      right: -50px;
    }

    /* SIDEBAR */
    .sidebar {
      width: var(--sidebar-w);
      flex-shrink: 0;
      background: var(--bg-2);
      border-right: 1px solid var(--glass-border);
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      z-index: 100;
      padding: 0 12px 20px;
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Sora', sans-serif;
      font-weight: 800;
      font-size: 1.3rem;
      padding: 20px 12px;
      margin-bottom: 8px;
      border-bottom: 1px solid var(--glass-border);
    }

    .nav-section {
      font-family: 'Sora', sans-serif;
      font-size: 0.67rem;
      font-weight: 700;
      color: rgba(255, 255, 255, 0.22);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      padding: 14px 12px 6px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 10px;
      margin-bottom: 1px;
      font-size: 0.88rem;
      color: var(--gray);
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
    }

    .nav-item:hover {
      background: var(--glass);
      color: var(--white);
    }

    .nav-item.active {
      background: rgba(124, 58, 237, 0.14);
      color: var(--white);
    }

    .nav-item .nav-icon {
      font-size: 1rem;
      width: 22px;
      text-align: center;
      flex-shrink: 0;
    }

    .nav-badge {
      margin-left: auto;
      background: var(--gradient);
      border-radius: 100px;
      font-size: 0.65rem;
      font-weight: 700;
      padding: 2px 7px;
      color: white;
    }

    .sidebar-divider {
      height: 1px;
      background: var(--glass-border);
      margin: 10px 0;
    }

    .sidebar-bottom {
      margin-top: auto;
    }

    .user-card {
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      padding: 11px 12px;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
    }

    .user-card:hover {
      background: rgba(255, 255, 255, 0.06);
    }

    .user-avatar-sq {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: var(--gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.9rem;
      flex-shrink: 0;
      overflow: hidden;
    }

    .user-avatar-sq img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
    }

    .user-info .name {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .user-info .plan {
      font-size: 0.72rem;
      color: var(--gray);
      margin-top: 1px;
    }

    .logout-btn {
      margin-left: auto;
      background: none;
      border: none;
      color: var(--gray);
      font-size: 1.1rem;
      cursor: pointer;
      padding: 4px;
      transition: color 0.2s;
    }

    .logout-btn:hover {
      color: var(--pink);
    }

    /* MAIN */
    .main {
      margin-left: var(--sidebar-w);
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      position: relative;
      z-index: 1;
    }

    .topbar {
      height: 68px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 32px;
      border-bottom: 1px solid var(--glass-border);
      background: rgba(10, 14, 26, 0.85);
      backdrop-filter: blur(20px);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .topbar-title {
      font-family: 'Sora', sans-serif;
      font-size: 1.1rem;
      font-weight: 700;
    }

    .topbar-sub {
      font-size: 0.78rem;
      color: var(--gray);
      margin-top: 1px;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .trial-badge {
      background: rgba(124, 58, 237, 0.14);
      border: 1px solid rgba(124, 58, 237, 0.28);
      border-radius: 100px;
      padding: 6px 14px;
      font-size: 0.78rem;
      color: var(--purple-light);
      font-weight: 600;
    }

    .btn-upgrade {
      background: var(--gradient);
      border: none;
      border-radius: 8px;
      color: white;
      font-family: 'Sora', sans-serif;
      font-weight: 700;
      font-size: 0.82rem;
      padding: 9px 18px;
      cursor: pointer;
      transition: var(--transition);
    }

    .btn-upgrade:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(124, 58, 237, 0.35);
    }

    .notif-btn {
      width: 36px;
      height: 36px;
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1rem;
      transition: var(--transition);
    }

    .notif-btn:hover {
      background: rgba(255, 255, 255, 0.08);
    }

    .content {
      padding: 28px 32px 40px;
      flex: 1;
    }

    /* WELCOME BANNER */
    .welcome-banner {
      background: linear-gradient(135deg, rgba(124, 58, 237, 0.18), rgba(244, 63, 117, 0.1));
      border: 1px solid rgba(124, 58, 237, 0.22);
      border-radius: 18px;
      padding: 24px 28px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
      margin-bottom: 24px;
    }

    .welcome-banner h2 {
      font-size: 1.2rem;
      font-weight: 800;
      margin-bottom: 5px;
    }

    .welcome-banner p {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.6);
    }

    .gradient-text {
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .btn-banner {
      background: var(--gradient);
      border: none;
      border-radius: 10px;
      color: white;
      font-family: 'Sora', sans-serif;
      font-weight: 700;
      font-size: 0.88rem;
      padding: 11px 20px;
      cursor: pointer;
      transition: var(--transition);
      white-space: nowrap;
    }

    .btn-banner:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(124, 58, 237, 0.38);
    }

    /* STATS */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }

    .stat-card {
      background: var(--bg-2);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 20px;
      transition: var(--transition);
    }

    .stat-card:hover {
      border-color: rgba(124, 58, 237, 0.25);
      transform: translateY(-2px);
    }

    .stat-label {
      font-size: 0.78rem;
      color: var(--gray);
      margin-bottom: 8px;
      font-weight: 500;
    }

    .stat-value {
      font-family: 'Sora', sans-serif;
      font-size: 2rem;
      font-weight: 800;
      margin-bottom: 6px;
    }

    .stat-note {
      font-size: 0.75rem;
      color: var(--gray);
    }

    .stat-note.up {
      color: #22c55e;
    }

    .stat-icon {
      font-size: 1.4rem;
      margin-bottom: 10px;
    }

    /* GRID */
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 24px;
    }

    .grid-3-1 {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
    }

    /* PANEL */
    .panel {
      background: var(--bg-2);
      border: 1px solid var(--glass-border);
      border-radius: 16px;
      padding: 20px;
    }

    .panel-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
    }

    .panel-title {
      font-family: 'Sora', sans-serif;
      font-size: 0.95rem;
      font-weight: 700;
    }

    .panel-action {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 8px;
      color: var(--gray);
      font-size: 0.75rem;
      padding: 6px 12px;
      cursor: pointer;
      transition: var(--transition);
    }

    .panel-action:hover {
      color: var(--white);
      background: rgba(255, 255, 255, 0.07);
    }

    /* CHART */
    .chart-area {
      display: flex;
      align-items: flex-end;
      gap: 6px;
      height: 120px;
    }

    .bar-col {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      height: 100%;
      justify-content: flex-end;
    }

    .bar {
      width: 100%;
      background: var(--gradient);
      border-radius: 6px 6px 0 0;
      transition: height 0.5s ease;
      min-height: 4px;
    }

    .bar-lbl {
      font-size: 0.65rem;
      color: var(--gray);
    }

    /* PLATFORMS */
    .platform-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--glass-border);
    }

    .platform-item:last-child {
      border-bottom: none;
    }

    .platform-icon {
      font-size: 1.3rem;
      width: 32px;
      text-align: center;
    }

    .platform-name {
      font-size: 0.88rem;
      font-weight: 500;
      flex: 1;
    }

    .p-status {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 100px;
      cursor: pointer;
    }

    .p-connect {
      color: var(--purple-light);
      background: rgba(124, 58, 237, 0.12);
      border: 1px solid rgba(124, 58, 237, 0.25);
    }

    .p-connect:hover {
      background: rgba(124, 58, 237, 0.22);
    }

    .p-active {
      color: #22c55e;
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.25);
    }

    .p-soon {
      color: var(--gray);
      background: var(--glass);
      border: 1px solid var(--glass-border);
    }

    /* CONVERSATIONS */
    .conv-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      border-bottom: 1px solid var(--glass-border);
      cursor: pointer;
      transition: var(--transition);
    }

    .conv-item:last-child {
      border-bottom: none;
    }

    .conv-item:hover {
      opacity: 0.8;
    }

    .conv-avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background: var(--gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.85rem;
      flex-shrink: 0;
    }

    .conv-info {
      flex: 1;
      min-width: 0;
    }

    .conv-name {
      font-size: 0.87rem;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .conv-msg {
      font-size: 0.77rem;
      color: var(--gray);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .conv-time {
      font-size: 0.7rem;
      color: var(--gray);
      flex-shrink: 0;
    }

    /* QUICK ACTIONS */
    .quick-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .quick-card {
      background: var(--glass);
      border: 1px solid var(--glass-border);
      border-radius: 12px;
      padding: 16px;
      cursor: pointer;
      text-align: center;
      transition: var(--transition);
      text-decoration: none;
      display: block;
    }

    .quick-card:hover {
      background: rgba(124, 58, 237, 0.09);
      border-color: rgba(124, 58, 237, 0.28);
      transform: translateY(-2px);
    }

    .quick-icon {
      font-size: 1.45rem;
      margin-bottom: 8px;
    }

    .quick-label {
      font-size: 0.78rem;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.72);
    }

    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 30px 20px;
    }

    .empty-icon {
      font-size: 2.5rem;
      margin-bottom: 12px;
      opacity: 0.5;
    }

    .empty-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .empty-sub {
      font-size: 0.8rem;
      color: var(--gray);
    }

    /* ACTIVITY FEED */
    .activity-item {
      display: flex;
      gap: 12px;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--purple);
      margin-top: 6px;
      flex-shrink: 0;
    }

    .activity-text {
      font-size: 0.8rem;
      color: var(--gray);
    }

    .activity-text strong {
      color: var(--white);
    }

    .activity-time {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.25);
      margin-top: 3px;
    }

    @media (max-width: 1100px) {
      .stats-row {
        grid-template-columns: repeat(2, 1fr);
      }

      .grid-2,
      .grid-3-1 {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        display: none;
      }

      .main {
        margin-left: 0;
      }

      .content {
        padding: 20px;
      }

      .topbar {
        padding: 0 20px;
      }

      .welcome-banner {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>

<body>
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>

  <aside class="sidebar">
    <div class="sidebar-logo"><span>‚ö°</span> DMAsistan</div>

    <div class="nav-section">Ana Men√º</div>
    <a class="nav-item active" href="dashboard.html"><span class="nav-icon">üìä</span> Dashboard</a>
    <a class="nav-item" href="conversations.html"><span class="nav-icon">üí¨</span> Konu≈ümalar <span class="nav-badge"
        id="unreadBadge" style="display:none">0</span></a>
    <a class="nav-item" href="automation.html"><span class="nav-icon">ü§ñ</span> AI & Otomasyon</a>
    <a class="nav-item" href="contacts.html"><span class="nav-icon">üë•</span> Ki≈üiler</a>
    <a class="nav-item" href="analytics.html"><span class="nav-icon">üìà</span> Analitik</a>
    <a class="nav-item" href="accounting.html"><span class="nav-icon">üí∞</span> Muhasebe</a>

    <div class="sidebar-divider"></div>
    <div class="nav-section">Ayarlar</div>
    <a class="nav-item" href="integrations.html"><span class="nav-icon">üîó</span> Entegrasyonlar</a>
    <a class="nav-item" href="website.html"><span class="nav-icon">üåê</span> Web Sitesi</a>
    <a class="nav-item" href="settings.html"><span class="nav-icon">‚öôÔ∏è</span> Ayarlar</a>
    <a class="nav-item" href="billing.html"><span class="nav-icon">üí≥</span> Faturalama</a>

    <div class="sidebar-divider"></div>
    <div class="sidebar-bottom">
      <a class="user-card" href="settings.html">
        <div class="user-info">
          <div class="name" id="sidebarName">Y√ºkleniyor...</div>
          <div class="plan">üÜì √úcretsiz Plan</div>
        </div>
        <button class="logout-btn" id="logoutBtn" title="√áƒ±kƒ±≈ü yap">‚èª</button>
      </a>
    </div>
  </aside>

  <div class="main">
    <div class="topbar">
      <div>
        <div class="topbar-title">Dashboard</div>
        <div class="topbar-sub" id="topbarGreet">Ho≈ü geldiniz</div>
      </div>
      <div class="topbar-right">
        <div class="notif-container" style="position:relative;">
          <div class="notif-btn" id="notifBtn" style="position:relative;">
            üîî
            <span class="has-new-alert"
              style="position:absolute; top:8px; right:8px; width:6px; height:6px; background:var(--pink); border-radius:50%;"></span>
          </div>
          <div class="notif-dropdown" id="notifDropdown"
            style="display:none; position:absolute; right:0; top:45px; width:300px; background:var(--bg-2); border:1px solid var(--glass-border); border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,0.5); z-index:100; overflow:hidden;">
            <div
              style="padding:15px; border-bottom:1px solid var(--glass-border); font-weight:700; font-family:'Sora', sans-serif;">
              Bildirimler</div>
            <div id="notifList" style="max-height:300px; overflow-y:auto; padding:10px;">
              <div style="text-align:center; padding:20px; color:var(--gray); font-size:0.8rem;">Y√ºkleniyor...</div>
            </div>
            <div id="notifClear"
              style="padding:10px; text-align:center; border-top:1px solid var(--glass-border); font-size:0.75rem; color:var(--purple-light); cursor:pointer;">
              T√ºm√ºn√º okundu i≈üaretle</div>
          </div>
        </div>
        <span class="trial-badge">‚è± 14 g√ºn deneme</span>
        <button class="btn-upgrade" onclick="location.href='billing.html'">‚ö° Y√ºkselt</button>
      </div>
    </div>

    <div class="content">
      <div class="welcome-banner">
        <div>
          <h2>üéâ Ho≈ü geldin, <span class="gradient-text" id="welcomeName">kullanƒ±cƒ±</span>!</h2>
          <p>ƒ∞lk platformunuzu baƒülayƒ±n ve otomatik satƒ±≈ülara ba≈ülayƒ±n.</p>
        </div>
        <button class="btn-banner" onclick="location.href='integrations.html'">Platform Baƒüla ‚Üí</button>
      </div>

      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-icon">üí¨</div>
          <div class="stat-label">Toplam Konu≈üma</div>
          <div class="stat-value" id="statConv">‚Äî</div>
          <div class="stat-note up" id="statConvNote">Y√ºkleniyor...</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">ü§ñ</div>
          <div class="stat-label">Otomatik Yanƒ±t</div>
          <div class="stat-value" id="statAi">‚Äî</div>
          <div class="stat-note" id="statAiNote">Y√ºkleniyor...</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üîó</div>
          <div class="stat-label">Baƒülƒ± Platform</div>
          <div class="stat-value" id="statPlatform">‚Äî</div>
          <div class="stat-note" id="statPlatformNote">Y√ºkleniyor...</div>
        </div>
        <div class="stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-label">Aktif Ki≈üi</div>
          <div class="stat-value" id="statContacts">‚Äî</div>
          <div class="stat-note up" id="statContactsNote">Y√ºkleniyor...</div>
        </div>
      </div>

      <!-- VAPI MINUTE BALANCE WIDGET -->
      <div class="panel" id="minuteWidget" style="margin-bottom: 24px;">
        <div class="panel-head">
          <div class="panel-title">üìû Telefon AI (Vapi) Dakika Bakiyesi</div>
          <button class="panel-action" onclick="location.href='billing.html'"
            style="background:var(--gradient);border:none;color:white;padding:6px 14px;border-radius:100px;font-weight:600;cursor:pointer;">Dakika
            Y√ºkle</button>
        </div>
        <div style="margin-top:12px;">
          <div style="display:flex; justify-content:space-between; font-size:0.85rem; margin-bottom:8px;">
            <span style="color:var(--gray)">Kullanƒ±lan: <strong id="usedMinVal" style="color:var(--white)">0</strong>
              dk</span>
            <span style="color:var(--gray)">Kalan: <strong id="leftMinVal" style="color:var(--white)">0</strong>
              dk</span>
          </div>
          <div style="height:8px; background:rgba(255,255,255,0.06); border-radius:10px; overflow:hidden;">
            <div id="minBar" style="height:100%; width:0%; background:var(--gradient); transition:width 0.5s ease;">
            </div>
          </div>
          <div id="minWarning" style="color:#f43f5e; font-size:0.75rem; font-weight:600; margin-top:8px; display:none;">
            ‚ö†Ô∏è Dikkat: Bakiyeniz %20'nin altƒ±na d√º≈üt√º. Kesinti ya≈üamamak i√ßin dakika y√ºkleyin.
          </div>
        </div>
      </div>

      <div class="grid-2">
        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">Konu≈üma Trendi</div>
            <button class="panel-action">Son 7 g√ºn</button>
          </div>
          <div class="chart-area" id="chartArea"></div>
        </div>

        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">Platformlar</div>
            <button class="panel-action" onclick="location.href='integrations.html'">T√ºm√ºn√º g√∂r</button>
          </div>
          <div class="platform-list" id="dashPlatformsList">
            <!-- Dinamik olarak JS ile doldurulacak -->
            <div style="padding:15px; text-align:center; color:var(--gray); font-size:0.8rem;">Y√ºkleniyor...</div>
          </div>
        </div>
      </div>

      <div class="grid-3-1">
        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">Hƒ±zlƒ± Muhasebe</div>
            <button class="panel-action" onclick="location.href='accounting.html'">T√ºm√ºn√º g√∂r ‚Üí</button>
          </div>
          <div class="empty-state">
            <div class="empty-icon">üí∞</div>
            <div class="empty-title">Muhasebe √ñzeti</div>
            <div class="empty-sub">Detaylƒ± raporlar i√ßin paneli kullanƒ±n</div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-head">
            <div class="panel-title">Hƒ±zlƒ± ƒ∞≈ülemler</div>
          </div>
          <div class="quick-grid">
            <a class="quick-card" href="automation.html">
              <div class="quick-icon">ü§ñ</div>
              <div class="quick-label">AI Ayarla</div>
            </a>
            <a class="quick-card" href="accounting.html">
              <div class="quick-icon">üìä</div>
              <div class="quick-label">Muhasebe</div>
            </a>
            <a class="quick-card" href="integrations.html">
              <div class="quick-icon">üîó</div>
              <div class="quick-label">Entegrasyon</div>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { supabase } from './supabase.js'
      ; (async () => {
        const { data: { session } } = await supabase.auth.getSession()
        if (!session) { window.location.replace('giris.html'); return }
        const user = session.user
        const name = user.user_metadata?.full_name || user.email.split('@')[0]
        const first = name.split(' ')[0]
        document.getElementById('sidebarName').textContent = name
        document.getElementById('welcomeName').textContent = first
        document.getElementById('topbarGreet').textContent = `Merhaba, ${first} üëã`

        // SADECE ADMƒ∞N ƒ∞SE Sƒ∞DEBAR'A ADMƒ∞N B√ñL√úM√úN√ú EKLE
        if (user.email === 'devrimtoytepe007@gmail.com') {
          const adminBtn = document.createElement('a');
          adminBtn.className = 'nav-item';
          adminBtn.href = 'admin.html';
          adminBtn.style.color = '#F43F75';
          adminBtn.style.backgroundColor = 'rgba(244, 63, 117, 0.1)';
          adminBtn.innerHTML = '<span class="nav-icon">üëë</span> S√ºper Admin';
          const navSection = document.querySelector('.nav-section');
          if (navSection) navSection.after(adminBtn);
        }

        // ‚îÄ‚îÄ Supabase'den ger√ßek veriler (paralel) ‚îÄ‚îÄ
        const uid = user.id
        const thisMonth = new Date(new Date().getFullYear(), new Date().getMonth(), 1).toISOString()
        const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString()

        const [convRes, aiRes, platRes, contactRes, chartRes, minRes] = await Promise.all([
          supabase.from('conversations').select('id', { count: 'exact', head: true }).eq('user_id', uid),
          supabase.from('messages').select('id', { count: 'exact', head: true }).eq('user_id', uid).eq('is_ai', true).gte('created_at', thisMonth),
          supabase.from('platforms').select('id, platform', { count: 'exact' }).eq('user_id', uid).eq('is_active', true),
          supabase.from('contacts').select('id', { count: 'exact', head: true }).eq('user_id', uid),
          supabase.from('conversations').select('created_at').eq('user_id', uid).gte('created_at', sevenDaysAgo),
          supabase.from('minute_balance').select('*').eq('user_id', uid).single()
        ])

        // Konu≈üma
        const convCount = convRes.count ?? 0
        document.getElementById('statConv').textContent = convCount
        document.getElementById('statConvNote').textContent = convCount > 0 ? `‚Üë ${convCount} konu≈üma` : '‚Üë Ba≈ülayƒ±n'

        // AI yanƒ±t
        const aiCount = aiRes.count ?? 0
        document.getElementById('statAi').textContent = aiCount
        document.getElementById('statAiNote').textContent = aiCount > 0 ? 'Bu ay AI yanƒ±tƒ±' : '7/24 hazƒ±r'

        // Platform
        const platD = platRes.data ?? []
        const platCount = platRes.count ?? 0
        document.getElementById('statPlatform').textContent = platCount
        document.getElementById('statPlatformNote').textContent = platCount > 0 ? `${platCount} platform aktif` : 'Platform baƒüla'
        if (platCount > 0) document.getElementById('statPlatformNote').classList.add('up')

        // Eƒüer platform varsa kar≈üƒ±lama bannerƒ±nƒ± gizle
        if (platCount > 0) {
          const banner = document.querySelector('.welcome-banner')
          if (banner) banner.style.display = 'none'
        }

        // Platform Listesini Dinamik Doldur
        const allPlatforms = [
          { code: 'instagram', name: 'Instagram', icon: 'üì∏' },
          { code: 'whatsapp', name: 'WhatsApp', icon: 'üí¨' },
          { code: 'facebook', name: 'Facebook', icon: 'üëç' }
        ]

        const platformListHtml = allPlatforms.map(p => {
          const isConnected = platD.some(dp => dp.platform === p.code)
          if (isConnected) {
            return `
                <div class="platform-item">
                  <span class="platform-icon">${p.icon}</span>
                  <span class="platform-name">${p.name}</span>
                  <span class="p-status p-active" onclick="location.href='integrations.html'">Baƒülƒ±</span>
                </div>`
          } else {
            return `
                <div class="platform-item">
                  <span class="platform-icon">${p.icon}</span>
                  <span class="platform-name">${p.name}</span>
                  <span class="p-status p-connect" onclick="location.href='integrations.html'">+ Baƒüla</span>
                </div>`
          }
        }).join('') + `
          <div class="platform-item">
            <span class="platform-icon">üéµ</span>
            <span class="platform-name">TikTok</span>
            <span class="p-status p-soon">Yakƒ±nda</span>
          </div>`

        document.getElementById('dashPlatformsList').innerHTML = platformListHtml

        // Vapi Dakika Bakiyesi
        const minuteData = minRes.data || { used_minutes: 0, total_minutes: 0 };
        const usedMin = minuteData.used_minutes || 0;
        const totalMin = minuteData.total_minutes || 0;
        let leftMin = totalMin - usedMin;
        if (leftMin < 0) leftMin = 0;

        document.getElementById('usedMinVal').textContent = usedMin;
        document.getElementById('leftMinVal').textContent = leftMin;

        let percent = totalMin > 0 ? (usedMin / totalMin) * 100 : 0;
        if (percent > 100) percent = 100;

        const minBar = document.getElementById('minBar');
        if (minBar) {
          minBar.style.width = percent + '%';
          if (leftMin > 0 && leftMin <= (totalMin * 0.2)) {
            minBar.style.background = 'linear-gradient(135deg, #F59E0B, #f43f5e)';
            document.getElementById('minWarning').style.display = 'block';
          } else if (leftMin === 0 && totalMin > 0) {
            minBar.style.background = '#f43f5e';
            document.getElementById('minWarning').style.display = 'block';
            document.getElementById('minWarning').textContent = '‚ö†Ô∏è Bakiyeniz t√ºkendi. Vapi asistanƒ±nƒ±z durduruldu.';
          } else if (totalMin === 0) {
            document.getElementById('minWarning').style.display = 'block';
            document.getElementById('minWarning').innerHTML = 'Hen√ºz dakika paketiniz yok. <a href="billing.html" style="color:#7C3AED;">Satƒ±n al</a>';
          }
        }


        // Ki≈üi
        const contactCount = contactRes.count ?? 0
        document.getElementById('statContacts').textContent = contactCount
        document.getElementById('statContactsNote').textContent = contactCount > 0 ? `${contactCount} ki≈üi` : 'B√ºy√ºmeye hazƒ±r'

        // ‚îÄ‚îÄ Ger√ßek chart (son 7 g√ºn) ‚îÄ‚îÄ
        const convData = chartRes.data ?? []
        const dayNames = ['Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt', 'Paz']
        const dayCounts = Array(7).fill(0)
        const now = new Date()
        convData.forEach(c => {
          const diffDays = Math.floor((now - new Date(c.created_at)) / (1000 * 60 * 60 * 24))
          if (diffDays >= 0 && diffDays < 7) dayCounts[6 - diffDays]++
        })
        const maxCount = Math.max(...dayCounts, 1)
        const dayLabels = Array.from({ length: 7 }, (_, i) => {
          const d = new Date(now); d.setDate(d.getDate() - (6 - i))
          return dayNames[d.getDay() === 0 ? 6 : d.getDay() - 1]
        })
        document.getElementById('chartArea').innerHTML = dayCounts.map((c, i) => `
        <div class="bar-col">
          <div class="bar" style="height:${Math.max(c / maxCount * 100, 4)}%" title="${c} konu≈üma"></div>
          <div class="bar-lbl">${dayLabels[i]}</div>
        </div>`).join('')

        document.getElementById('notifBtn')?.addEventListener('click', (e) => {
          e.stopPropagation()
          const drop = document.getElementById('notifDropdown')
          if (drop) drop.style.display = drop.style.display === 'none' ? 'block' : 'none'
        })
        document.addEventListener('click', (e) => {
          const drop = document.getElementById('notifDropdown')
          if (drop && !document.getElementById('notifBtn').contains(e.target)) {
            drop.style.display = 'none'
          }
        })

        supabase.auth.onAuthStateChange((event) => {
          if (event === 'SIGNED_OUT') window.location.replace('giris.html')
        })

        // Dinamik Bildirimler
        const notifBadge = document.querySelector('.has-new-alert')
        const notifList = document.getElementById('notifList')

        async function loadNotifications() {
          const { data: msgs } = await supabase.from('messages')
            .select('content, created_at, conversations(platform)')
            .eq('user_id', uid)
            .eq('is_ai', false)
            .order('created_at', { ascending: false })
            .limit(5);

          if (!msgs || msgs.length === 0) {
            notifList.innerHTML = `<div style="text-align:center; padding:20px; color:var(--gray); font-size:0.8rem;">Yeni bildirim yok</div>`;
            return;
          }

          notifList.innerHTML = msgs.map(m => {
            const platName = m.conversations?.platform || 'Bilinmiyor';
            const icon = platName === 'instagram' ? 'üì∏' : (platName === 'whatsapp' ? 'üí¨' : 'üëç');
            const time = new Date(m.created_at).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
            return `
              <div style="padding:10px; border-bottom:1px solid rgba(255,255,255,0.05); font-size:0.8rem; display:flex; gap:10px; cursor:pointer;" onclick="location.href='conversations.html'">
                <div style="font-size:1.2rem;">${icon}</div>
                <div style="flex:1; overflow:hidden;">
                    <strong style="color:white; display:block; margin-bottom:2px;">Yeni Mesaj (${platName})</strong>
                    <div style="color:var(--gray); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${m.content}</div>
                    <div style="font-size:0.65rem; color:var(--purple-light); margin-top:4px;">${time}</div>
                </div>
              </div>`
          }).join('');
        }

        loadNotifications();

        // Okundu i≈üaretlendiƒüinde kƒ±rmƒ±zƒ± ƒ±≈üƒ±ƒüƒ± gizle
        document.getElementById('notifClear')?.addEventListener('click', () => {
          notifBadge.style.display = 'none';
        });

        // Yeni mesaj geldiƒüinde canlƒ± olarak yakala
        supabase.channel('dashboard_notifications')
          .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'messages', filter: `user_id=eq.${uid}` }, (payload) => {
            if (!payload.new.is_ai) {
              notifBadge.style.display = 'block'; // Kƒ±rmƒ±zƒ± ƒ±≈üƒ±ƒüƒ± yak
              loadNotifications(); // Bildirim listesini g√ºncelle

              // Hafif bir "ting" sesi √ßal
              const audio = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');
              audio.volume = 0.5;
              audio.play().catch(e => console.log(e));
            }
          }).subscribe();

        // Okunmamƒ±≈ü konu≈üma badge'i
        const { count: unreadCount } = await supabase
          .from('conversations')
          .select('id', { count: 'exact', head: true })
          .eq('user_id', uid)
          .eq('status', 'open')
        const badge = document.getElementById('unreadBadge')
        if (badge && unreadCount > 0) {
          badge.textContent = unreadCount > 99 ? '99+' : unreadCount
          badge.style.display = 'inline'
        }
      })()
    document.getElementById('logoutBtn').addEventListener('click', async (e) => {
      e.preventDefault(); e.stopPropagation()
      await supabase.auth.signOut()
      window.location.href = 'giris.html'
    })
  </script>
  <script type="module" src="mobile-nav.js"></script>
  <script src="sw-register.js"></script>
  <script src="ai-assistant.js"></script>
</body>

</html>